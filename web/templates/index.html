{{define "content"}}
<article>
    <header style="display:flex; justify-content:space-between; align-items:center; gap:1rem;">
        <div role="search" style="flex-grow:1; max-width:400px;">
            <input type="search" name="q" placeholder="Filter inventory..." value="{{.Query}}" style="margin-bottom:0;"
                autocomplete="off" 
                hx-get="/" 
                hx-trigger="input changed delay:500ms, search" 
                hx-target="#inventory-list" 
                hx-select="#inventory-list"
                hx-push-url="true">
        </div>
        <button onclick="document.getElementById('add-modal').showModal()">+ Add Card</button>
    </header>

    <div id="inventory-list">
        <div class="table-responsive">
            <table class="striped">
                <thead>
                    <tr>
                        <th scope="col">Image</th>
                        <th scope="col">Name</th>
                        <th scope="col">Set Details</th>
                        <th scope="col">Qty</th>
                        <th scope="col">Info</th>
                        <th scope="col">Action</th>
                    </tr>
                </thead>
                <tbody id="inventory-table-body">
                    {{range .Items}}
                    <tr>
                        <td>{{if .ImageURI}}<img src="{{.ImageURI}}"
                                style="height:60px; border-radius:4px;">{{else}}-{{end}}
                        </td>
                        <td><strong>{{.CardName}}</strong></td>
                        <td>
                            <small style="text-transform: uppercase;">{{.SetCode}} #{{.CollectorNumber}}</small>
                        </td>
                        <td>{{.Quantity}}</td>
                        <td>
                            <span data-tooltip="Condition">{{.Condition}}</span>
                            {{if .IsFoil}}<span data-tooltip="Foil"> (foil) </span>{{end}}
                            <small>{{.Language}}</small>
                        </td>
                        <td>
                            <button class="outline" style="padding:0.25rem 0.5rem; font-size:0.8rem;"
                                hx-get="/inventory/edit/{{.ID}}" hx-target="#edit-modal">Edit</button>
                            <button class="outline danger" style="padding:0.25rem 0.5rem; font-size:0.8rem;"
                                hx-delete="/inventory/{{.ID}}" hx-target="closest tr" hx-swap="outerHTML"
                                hx-confirm="Are you sure?">Del</button>
                        </td>
                    </tr>
                    {{else}}
                    <tr>
                        <td colspan="6" style="text-align:center; padding: 2rem;">No cards found.</td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        {{if gt .TotalPages 1}}
        <nav
            style="display: flex; justify-content: center; align-items: center; gap: 1rem; margin-top: 1.5rem; padding-top: 1rem; border-top: 1px solid var(--border-color);">
            {{if .HasPrev}}
            <a href="?page={{sub .Page 1}}{{if .Query}}&q={{.Query}}{{end}}" role="button" class="outline">Previous</a>
            {{else}}
            <button disabled class="outline">‚Üê Previous</button>
            {{end}}

            <span style="color: var(--text-secondary);">Page {{.Page}} of {{.TotalPages}}</span>

            {{if .HasNext}}
            <a href="?page={{add .Page 1}}{{if .Query}}&q={{.Query}}{{end}}" role="button" class="outline">Next</a>
            {{else}}
            <button disabled class="outline">Next</button>
            {{end}}
        </nav>
        {{end}}
    </div>
</article>

<script>
    document.body.addEventListener('htmx:afterRequest', function (evt) {
        if (evt.detail.successful && evt.detail.elt.hasAttribute('hx-delete')) {
            const tbody = document.getElementById('inventory-table-body');
            if (tbody && tbody.childElementCount === 0) {
                tbody.innerHTML = `
                <tr>
                    <td colspan="6" style="text-align:center; padding: 2rem;">No cards found.</td>
                </tr>`;
            }
        }
    });
</script>
{{end}}